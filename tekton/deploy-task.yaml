# apiVersion: tekton.dev/v1alpha1
# kind: Task
# metadata:
#   name: apply-manifests
# spec:
#   inputs:
#     resources:
#       - {type: git, name: source}
#     params:
#       - name: manifest_dir
#         description: The directory in source that contains yaml manifests
#         type: string
#         default: "k8s"

#   steps:
#     - name: apply
#       image: quay.io/openshift/origin-cli:latest
#       workingDir: /workspace/source
#       command: ["/bin/bash", "-c"]
#       args:
#         - |-
#           echo Applying manifests in $(inputs.params.manifest_dir) directory
#           oc apply -f $(inputs.params.manifest_dir)
#           echo -----------------------------------
# ---
# apiVersion: tekton.dev/v1alpha1
# kind: Task
# metadata:
#   name: update-deployment
# spec:
#   inputs:
#     resources:
#       - {type: image, name: image}
#     params:
#       - name: deployment
#         description: The name of the deployment patch the image
#         type: string

#   steps:
#     - name: patch
#       image: quay.io/openshift/origin-cli:latest
#       command: ["/bin/bash", "-c"]
#       args:
#         - |-
#           oc patch deployment $(inputs.params.deployment) --patch='{"spec":{"template":{"spec":{
#             "containers":[{
#               "name": "$(inputs.params.deployment)",
#               "image":"$(inputs.resources.image.url)"
#             }]
#           }}}}'
# ---
apiVersion: tekton.dev/v1alpha1
kind: Task
metadata:
  name: deploy-kubectl
spec:
  inputs:
    resources:
    - name: source
      type: git
    params:
    - name: k8s-directory-path
      description: Path to the directory for kubectl apply -f
      default: config
  steps:
  - name: apply-config
    image: lachlanevenson/k8s-kubectl
    command: ['kubectl']
    args:
    - 'apply'
    - '-f'
    - './git-source/$(k8s-directory-path)'